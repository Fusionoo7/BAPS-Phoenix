<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puri & Roti Calculator</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    :root{
      --bg:#0b1220;--panel:#131c2b;--muted:#95a3b8;--text:#e9eef7;--brand:#e63946;--brand-2:#eab308;--accent:#1f2a44;--ring:#2b3a57;
    }
    html,body{height:100%}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; color:var(--text); background:radial-gradient(1200px 800px at 10% -10%, #1a2235 0%, transparent 60%),radial-gradient(1000px 700px at 100% 0%, #101827 0%, transparent 60%),var(--bg);}    
    .wrap{max-width:1100px;margin:32px auto;padding:16px}
    .logo{display:block;margin:0 auto 12px auto; height:80px;}
    .card{background:var(--panel); border:1px solid var(--ring); border-radius:16px; padding:22px; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1{margin:8px 0 16px 0; font-size:34px; letter-spacing:.2px}
    p.lead{color:var(--muted); margin-top:0}
    .grid{display:grid; gap:16px}
    @media(min-width:920px){.grid{grid-template-columns:1.1fr 1fr}}
    label{display:block; margin:6px 0 6px 0; color:var(--muted)}
    input,select{width:100%; padding:14px 12px; border-radius:12px; border:1px solid var(--ring); background:#0f1725; color:var(--text); outline:none}
    input:focus,select:focus{border-color:#4f6bdc; box-shadow:0 0 0 4px rgba(79,107,220,.2)}
    .kpi{background:#0f1725; border:1px solid var(--ring); border-radius:14px; padding:16px}
    .kpi h3{margin:0 0 6px 0; font-size:14px; color:var(--muted)}
    .kpi .val{font-size:26px; font-weight:700}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .btn{border:1px solid var(--ring); background:#0f1725; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer}
    .btn:hover{border-color:#6b86ff}
    .pill{display:inline-block; padding:6px 10px; border-radius:999px; background:#0f1725; border:1px solid var(--ring); color:var(--muted); font-size:12px}

    /* Tabs */
    .tabs{display:flex; gap:10px; margin:12px 0 18px 0; flex-wrap:wrap}
    .tab{padding:10px 14px; border-radius:999px; border:1px solid var(--ring); background:#0f1725; color:var(--text); cursor:pointer; user-select:none}
    .tab.active{background:linear-gradient(90deg, var(--brand-2), var(--brand)); color:#0c0c0c; border-color:transparent; font-weight:700}
    .view{display:none}
    .view.active{display:block}

    /* Freezer cards */
    .fz{background:#0f1725; border:1px solid var(--ring); border-radius:12px; padding:10px}
    .fz h4{margin:0 0 6px 0; font-size:14px; color:var(--brand-2)}
    .fz .lvl{color:var(--muted); font-size:12px}
    .fz textarea{width:100%; min-height:120px; border-radius:8px; border:1px solid var(--ring); background:#0b1420; color:var(--text); padding:8px}
  </style>
</head>
<body>
  <div class="wrap">


    <div class="card">
      <h1>Puri & Roti Production</h1>
      <p class="lead">Inputs on the left. Outputs update live. Use tabs to switch. Share the URL after setting values.</p>

      <div class="tabs">
        <button class="tab" data-tab="calc">Puri calculator</button>
        <button class="tab" data-tab="roti">Roti calculator</button>
      </div>

      <!-- PURI VIEW -->
      <section id="view-calc" class="view">
        <div class="grid">
          <div>
            <label>Number of people</label>
            <input id="p-people" type="number" min="0" step="1" value="50"/>

            <label style="margin-top:10px">Puris per person</label>
            <input id="p-per" type="number" min="0" step="1" value="4"/>

            <label style="margin-top:10px">Puri size</label>
            <select id="p-size">
              <option value="3.5">3.5 inch</option>
              <option value="4" selected>4.0 inch</option>
            </select>

            <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="btn-copy">Copy results</button>
              <button class="btn" id="btn-reset">Reset</button>
              <button class="btn" id="btn-print">Print</button>
            </div>

            <p style="margin-top:10px; color:var(--muted); font-size:13px">Assumptions: 3.5" → 53 puris/cup · 4" → 43 puris/cup · Oil = 16 oz / 250 puris · Salt = 1 spoon / 100 puris</p>
          </div>

          <div class="grid" style="grid-template-columns:1fr; gap:12px">
            <div class="kpi"><h3>Total puris</h3><div class="val" id="p-total">0</div></div>
            <div class="kpi"><h3>Flour needed</h3><div class="val"><span id="p-flour">0</span> <span class="pill">Lb</span></div></div>
            <div class="kpi"><h3>Oil needed</h3><div class="val"><span id="p-oil">0</span> <span class="pill">oz</span></div></div>
            <div class="kpi"><h3>Salt needed</h3><div class="val"><span id="p-salt">0</span> <span class="pill">spoons</span></div></div>
            <div class="kpi"><h3>Water needed</h3><div class="val"><span id="p-water-l">0</span> <span class="pill">liters</span></div></div>
            <div><span class="pill" id="p-yield-pill">Yield</span></div>
          </div>
        </div>
      </section>

      <!-- ROTI VIEW -->
      <section id="view-roti" class="view">
        <div class="grid">
          <div>
            <label>Number of people</label>
            <input id="r-people" type="number" min="0" step="1" value="50"/>

            <label style="margin-top:10px">Rotis per person</label>
            <input id="r-per" type="number" min="0" step="1" value="3"/>

            <label style="margin-top:10px">Rotis per cup of flour</label>
            <input id="r-yield" type="number" min="1" step="1" value="12"/>

            <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="r-btn-copy">Copy results</button>
              <button class="btn" id="r-btn-reset">Reset</button>
            </div>

            <p style="margin-top:10px; color:var(--muted); font-size:13px">Defaults: yield 12 rotis/cup · Salt = 1 spoon / 100 rotis. No frying oil assumed.</p>
          </div>

          <div class="grid" style="grid-template-columns:1fr; gap:12px">
            <div class="kpi"><h3>Total rotis</h3><div class="val" id="r-total">0</div></div>
            <div class="kpi"><h3>Flour needed</h3><div class="val"><span id="r-flour">0</span> <span class="pill">cups</span></div></div>
            <div class="kpi"><h3>Salt needed</h3><div class="val"><span id="r-salt">0</span> <span class="pill">spoons</span></div></div>
            <div class="kpi"><h3>Water needed</h3><div class="val"><span id="r-water-l">0</span> <span class="pill">liters</span></div></div>
          </div>
        </div>
      </section>

      <p style="margin-top:18px; color:var(--muted); font-size:12px">Bookmark after changing inputs. Works offline after first load.</p>
    </div>
  </div>

<script>
  // ===== CONSTANTS =====
  const CUP_TO_LITER = 0.24;
  const OIL_PER_PURI_OZ = 16/250;  // 0.064 oz per puri
  const SALT_PER_100 = 1;          // 1 spoon per 100 puris/rotis
  const WATER_PER_FLOUR_CUP_PURIS = 0.50; // cups water per flour cup (puri)
  const WATER_PER_FLOUR_CUP_ROTI  = 0.60; // cups water per flour cup (roti)

  // ===== HELPERS =====
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));
  const store = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const load  = (k,d)=>{try{const v=JSON.parse(localStorage.getItem(k));return v??d;}catch{return d}}
  const round = (n,d=2)=>{const f=10**d; return Math.round(n*f)/f}
  function setVal(sel, v){ const el=$(sel); if(!el) return; el.textContent = Number.isFinite(v)? v.toLocaleString(undefined,{maximumFractionDigits:2}) : String(v); }

  // ===== PURE CALC FUNCTIONS (testable) =====
  function calcPuri(totalPuris, sizeInch){
    const yieldCup = (String(sizeInch)==='3.5')?53:43;
    const flour = totalPuris / yieldCup;
    const oil = totalPuris * OIL_PER_PURI_OZ;
    const salt = (totalPuris/100) * SALT_PER_100;
    const waterL = flour * WATER_PER_FLOUR_CUP_PURIS * CUP_TO_LITER;
    return {yieldCup, flour, oil, salt, waterL};
  }
  function calcRoti(totalRotis, rotisPerCup){
    const y = Math.max(1, Number(rotisPerCup)||12);
    const flour = totalRotis / y;
    const salt = (totalRotis/100) * SALT_PER_100;
    const waterL = flour * WATER_PER_FLOUR_CUP_ROTI * CUP_TO_LITER;
    return {yieldCup:y, flour, salt, waterL};
  }

  // ===== RENDERERS =====
  function renderPuri(){
    const people = Number($('#p-people').value||0);
    const per    = Number($('#p-per').value||0);
    const size   = $('#p-size').value;
    const total  = people * per;
    const r = calcPuri(total, size);
    setVal('#p-total', total);
    setVal('#p-flour', round(r.flour,2));
    setVal('#p-oil', round(r.oil,1));
    setVal('#p-salt', round(r.salt,1));
    setVal('#p-water-l', round(r.waterL,2));
    $('#p-yield-pill').textContent = `Yield: ${r.yieldCup} puris/cup`;
  }
  function renderRoti(){
    const people = Number($('#r-people').value||0);
    const per    = Number($('#r-per').value||0);
    const yld    = Number($('#r-yield').value||12);
    const total  = people * per;
    const r = calcRoti(total, yld);
    setVal('#r-total', total);
    setVal('#r-flour', round(r.flour,2));
    setVal('#r-salt', round(r.salt,1));
    setVal('#r-water-l', round(r.waterL,2));
  }

  // ===== RECOMPUTE (fix for earlier ReferenceError) =====
  function recompute(){
    renderPuri();
    renderRoti();
  }

  // ===== TABS =====
  const tabMap = {calc:'view-calc', roti:'view-roti'};
  function setTab(t){
    Object.entries(tabMap).forEach(([k,v])=>{
      document.getElementById(v).classList.toggle('active', k===t);
      document.querySelector(`.tab[data-tab="${k}"]`).classList.toggle('active', k===t);
    });
    const url = new URL(location);
    url.searchParams.set('t', t);
    history.replaceState(null,'',url);
    store('activeTab', t);
    recompute();
  }
  $$('.tab').forEach(b=> b.addEventListener('click', ()=> setTab(b.dataset.tab)));

  // (freezer inventory removed at user request)

  // ===== WIRING: INPUTS → STATE → RECOMPUTE =====
  ['#p-people','#p-per','#p-size','#r-people','#r-per','#r-yield'].forEach(sel=>{
    const el=$(sel); if(!el) return;
    el.addEventListener('input', ()=>{
      // Persist puri/roti inputs separately
      if(sel.startsWith('#p-')){
        store('p.people', Number($('#p-people').value||0));
        store('p.per',    Number($('#p-per').value||0));
        store('p.size',   $('#p-size').value);
      } else if(sel.startsWith('#r-')){
        store('r.people', Number($('#r-people').value||0));
        store('r.per',    Number($('#r-per').value||0));
        store('r.yield',  Number($('#r-yield').value||12));
      }
      recompute();
    });
  });

  // Buttons
  $('#btn-copy').onclick   = ()=> navigator.clipboard.writeText(location.href);
  $('#r-btn-copy').onclick = ()=> navigator.clipboard.writeText(location.href);
  $('#btn-print').onclick  = ()=> window.print();
  $('#btn-reset').onclick  = ()=>{ $('#p-people').value=50; $('#p-per').value=4; $('#p-size').value='4'; recompute(); }
  $('#r-btn-reset').onclick= ()=>{ $('#r-people').value=50; $('#r-per').value=3; $('#r-yield').value=12; recompute(); }

  // ===== INIT =====
  (function init(){
    // Restore inputs from storage if present
    const pp=load('p.people', null); if(pp!==null) $('#p-people').value=pp;
    const pr=load('p.per', null);    if(pr!==null) $('#p-per').value=pr;
    const ps=load('p.size', null);   if(ps!==null) $('#p-size').value=ps;
    const rp=load('r.people', null); if(rp!==null) $('#r-people').value=rp;
    const rr=load('r.per', null);    if(rr!==null) $('#r-per').value=rr;
    const ry=load('r.yield', null);  if(ry!==null) $('#r-yield').value=ry;

    // Activate tab from URL or storage
    const url = new URL(location);
    const t = url.searchParams.get('t') || load('activeTab','calc');
    setTab(['calc','roti'].includes(t)?t:'calc');

    // Initial compute for visible values
    recompute();
  })();

  // ===== SELF-TESTS (console) =====
  (function selfTests(){
    function approx(a,b,t=1e-6){return Math.abs(a-b)<=t}
    try{
      // Regex newline split
      console.assert('a\nb'.split(/\n+/).length===2, 'newline split');
      // Puri calc sanity: 10 people * 5 puris, size 4"
      const total=50; const r = calcPuri(total,'4');
      console.assert(approx(r.yieldCup,43), 'yield 4" = 43');
      console.assert(approx(round(r.flour,4), round(total/43,4)), 'flour matches');
      console.assert(approx(round(r.oil,4), round(total*(16/250),4)), 'oil matches');
      console.assert(approx(round(r.salt,4), round((total/100)*1,4)), 'salt matches');
      console.assert(approx(round(r.waterL,4), round((total/43)*0.50*0.24,4)), 'water L matches');
      console.log('Self-tests passed');
    }catch(e){ console.error('Self-tests failed', e); }
  })();
</script>
</body>
</html>
